# cl0p Ransomware - LetsDefend Challenge

[Getting Started to LetsDefend](https://app.letsdefend.io/challenge/cl0p-ransomware)

## Summary

Our friend fell victim to a ransomware attack and reached out to seek your expertise in analyzing the system to uncover the cause of the breach. We have provided you with a memory dump of his computer as the starting point for your investigation.

This challenge prepared by [@MalGamy12](https://twitter.com/MalGamy12)

## Questions

1. What is the memory dump profile?
2. What is the parent process of the ransomware?
3. The ransomware encrypted data with a specific extension. What is the extension?
4. The ransomware was hidden in Windows so you can find the full path. (Answer Format: \Users\.....)
5. What is DTB of the ransomware?
6. What is the Mitre ID of the “Obfuscated Files or Information”?
7. The ransom dropped a readme message but it seems we couldn't dump it. We need to find the email of the manager?

## Findings

1. “*What is the memory dump profile?”* First and foremost, let’s find the vmem profile using Volatility2. *Reason to use python2 due to python3 running the volatility showing is taking like forever.*
`python2 vol.py imageinfo -f ~/Desktop/R4n.vmem`
    
    ```bash
    Volatility Foundation Volatility Framework 2.6.1
    INFO    : volatility.debug    : Determining profile based on KDBG search...
              Suggested Profile(s) : **Win10x64_19041 <<- This is the profile we should use**
                         AS Layer1 : SkipDuplicatesAMD64PagedMemory (Kernel AS)
                         AS Layer2 : FileAddressSpace (/root/Desktop/R4n.vmem)
                          PAE type : No PAE
                               DTB : 0x1ad000L
                              KDBG : 0xf80428603b20L
              Number of Processors : 2
         Image Type (Service Pack) : 0
                    KPCR for CPU 0 : 0xfffff80426907000L
                    KPCR for CPU 1 : 0xffffaf8003467000L
                 KUSER_SHARED_DATA : 0xfffff78000000000L
               Image date and time : 2023-07-24 15:50:31 UTC+0000
         Image local date and time : 2023-07-24 08:50:31 -0700
    ```
    
2. “*What is the parent process of the ransomware?*” Let’s further investigate into the pstree of the memory dump. `python2 vol.py -f ~/Desktop/R4n.vmem —profile=Win10x64_19041 pstree`  
    
    As from the results, we saw a suspicious executing program “***R4n50m.exe***” is running under explorer.exe
    
3. “*The ransomware encrypted data with a specific extension. What is the extension?*” As the ransomware behavior it will encrypted all the document data on victim’s pc. First we do mftparser of the memory dump to identify the file object in common storage path such as Desktop/ Document/ Downloads etc. 
`python2 vol.py -f ~/Desktop/R4n.vmem —profile=Win10x64_19041 mftparser`
As the results shows we have few suspect profile to further investigate. Users shown in the results one is `\Users\Work` `\Users\Public` and `\Users\Default`
    
    Next, let’s further investigate into three users directory. Let’s start with “work” user desktop
    
    `python2 vol.py -f ~/Desktop/R4n.vmem —profile=Win10x64_19041 mftparser | grep 'Users\\Work\\Desktop'`
    
    Here we found the desktop file is being encrypted with  .CLO and .clop.
    
4. “*The ransomware was hidden in Windows so you can find the full path. (Answer Format: \Users\.....)*” We can use volatility filescan features to find the ‘R4n50m.exe’ from the vmem file as we’re lucky to that ransomware program is not renamed to randomize name.
`python2 vol.py -f ~/Desktop/R4n.vmem —profile=Win10x64_19041 filescan | grep 'R4n50m.exe'`
results we have is *\Users\Work\Appdata\Local\Temp\R4n50m.exe*
5. “*What is DTB of the ransomware?*” In this steps we will use memmap command to extract ransomware process DTB. It shows you the virtual address of the page, the corresponding physical offset of the page, and the size of the page. The map information generated by this plugin comes from the underlying address space’s get_available_addresses method. First we need to find the ‘***R4n50m.exe***’ pid.
`python2 vol.py -f ~/Desktop/R4n.vmem —profile=Win10x64_19041 pslist | grep 'R4n50m.exe'`
    
    ```bash
    └──╼ $sudo python vol.py -f ~/Downloads/R4n.vmem --profile=Win10x64_19041 pslist | grep 'R4n50m.exe'
    Volatility Foundation Volatility Framework 2.6.1
    0xffffc402e99e5080 R4n50m.exe             6212   3564      3        0      1      1 2023-07-24 15:45:04 UTC+0000
    ```
    
    As the result above shown ***R4n50m.exe*** pid is 6212. Next we will demonstration the DTB of PID 6212 using `volshell`.
    
    ```bash
    python2 vol.py -f ~/Desktop/R4n.vmem —profile=Win10x64_19041 volshell -p 6212
    Volatility Foundation Volatility Framework 2.6.1
    Current context: R4n50m.exe @ 0xffffc402e99e5080, pid=6212, ppid=3564 DTB=0x45ebb000
    Welcome to volshell! Current memory image is:
    file:///home/eugene/Downloads/R4n.vmem
    To get help, type 'hh()'
    >>>
    ```
    
6. “*What is the Mitre ID of the “Obfuscated Files or Information”?*” We will search the Mitre ID based on the Obfuscated files or Information category with ‘clop’ attacks and the results shown to T1027.002.
    
    [Obfuscated Files or Information: Software Packing, Sub-technique T1027.002 - Enterprise | MITRE ATT&CK®](https://attack.mitre.org/techniques/T1027/002/)
    
7. “*The ransom dropped a readme message but it seems we couldn't dump it. We need to find the email of the manager?*” We could retrieve the readme message from the dump file, so we google it and based on the Clop generated text file (”ClopReadMe.txt”) we found number of contact.
    
    ```bash
    servicedigilogos@protonmail.com, 
    managersmaers@tutanota.com, 
    unlock@goldenbay.su, 
    unlock@graylegion.su
    ```
    
    [Clop Ransomware](https://www.pcrisk.com/removal-guides/14451-clop-ransomware)
